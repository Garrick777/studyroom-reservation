# ========================================
# 智慧自习室系统配置
# ========================================

server:
  port: 9090
  servlet:
    context-path: /api

spring:
  application:
    name: studyroom-system
  
  # 数据源配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/studyroom?useUnicode=true&characterEncoding=UTF-8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&connectionCollation=utf8mb4_unicode_ci
    username: root
    password: 123456789
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      idle-timeout: 30000
      pool-name: StudyRoomHikariCP
      max-lifetime: 1800000
      connection-timeout: 30000
  
  # Redis配置
  data:
    redis:
      host: localhost
      port: 6379
      password: 
      database: 0
      timeout: 10000ms
      lettuce:
        pool:
          max-active: 8
          max-wait: -1ms
          max-idle: 8
          min-idle: 0
  
  # Jackson配置
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: Asia/Shanghai
    serialization:
      write-dates-as-timestamps: false
    default-property-inclusion: non_null
  
  # 文件上传配置
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 20MB

# MyBatis Plus配置
mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  type-aliases-package: com.studyroom.entity
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0
      insert-strategy: not_null
      update-strategy: not_null
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

# JWT配置
jwt:
  secret: YourVeryLongAndSecureSecretKeyForJWTTokenGenerationStudyRoom2026
  expiration: 86400000  # 24小时
  refresh-expiration: 604800000  # 7天
  header: Authorization
  prefix: "Bearer "

# Knife4j配置
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha
  api-docs:
    path: /v3/api-docs
  group-configs:
    - group: '全部接口'
      paths-to-match: '/**'
      packages-to-scan: com.studyroom.controller

knife4j:
  enable: true
  setting:
    language: zh_cn
    enable-swagger-models: true
    enable-document-manage: true
    swagger-model-name: 实体类

# 日志配置
logging:
  level:
    root: INFO
    com.studyroom: DEBUG
    com.studyroom.mapper: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# 文件上传路径
upload:
  path: ./uploads
  avatar-path: /avatars
  image-path: /images

# 自定义配置
studyroom:
  # 预约配置
  reservation:
    advance-days: 7           # 可提前预约天数
    max-per-day: 3            # 每天最多预约次数
    cancel-limit-minutes: 30  # 开始前多少分钟不可取消
  
  # 签到配置
  checkin:
    early-minutes: 15         # 可提前签到分钟数
    late-minutes: 15          # 迟到容忍分钟数
    timeout-minutes: 30       # 未签到超时分钟数
  
  # 暂离配置
  leave:
    max-minutes: 30           # 最大暂离时长
    max-count: 3              # 每次预约最多暂离次数
  
  # 信用分配置
  credit:
    default-score: 100        # 初始信用分
    min-score: 0              # 最低信用分
    max-score: 100            # 最高信用分
    no-show-penalty: 10       # 未签到扣分
    late-cancel-penalty: 5    # 迟到取消扣分
    overtime-leave-penalty: 3 # 暂离超时扣分
  
  # 黑名单配置
  blacklist:
    threshold: 60             # 低于此分进入黑名单
    duration-days: 7          # 黑名单持续天数
